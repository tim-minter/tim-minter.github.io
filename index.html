<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat Flinging Game</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <button id="audio-button" style="position: fixed; top: 10px; left: 10px; z-index: 1000;">Enable Sound</button>
    <script>
        // Tim Minter 2024

        let width = window.innerWidth;
        let height = window.innerHeight;

        // Create an SVG element to cover the entire screen
        const svg = d3.select("body").append("svg")
          .attr("width", width)
          .attr("height", height)
          .call(d3.zoom().on("zoom", (event) => {
            svg.attr("transform", event.transform);
          }))
          .append("g");

        let catsData = [
          { id: 1, imageUrl: 'cat-image1.png', x: 100, y: height - 150 },
          { id: 2, imageUrl: 'cat-image2.png', x: 300, y: height - 150 }
        ];

        let catSize = Math.min(100, width / 10);

        // Define drag behavior
        const dragBehavior = d3.drag()
          .on("start", dragStarted)
          .on("drag", dragged)
          .on("end", dragEnded);

        // Adding cats to the screen
        const cats = svg.selectAll(".cat")
          .data(catsData)
          .enter()
          .append("image")
          .attr("class", "cat")
          .attr("x", d => d.x)
          .attr("y", d => d.y)
          .attr("width", catSize)
          .attr("height", catSize)
          .attr("xlink:href", d => d.imageUrl)
          .call(dragBehavior);

        // Audio context setup for better mobile browser support
        let audioContext;
        let audioBuffer;

        async function setupAudio() {
          audioContext = new (window.AudioContext || window.webkitAudioContext)();
          const response = await fetch('cat.mp3');
          const arrayBuffer = await response.arrayBuffer();
          audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
        }

        function playSound() {
          if (audioContext && audioBuffer) {
            const source = audioContext.createBufferSource();
            source.buffer = audioBuffer;
            source.connect(audioContext.destination);
            source.start(0);
          }
        }

        // Enable sound button for mobile browsers
        document.getElementById('audio-button').addEventListener('click', () => {
          if (!audioContext) {
            setupAudio().then(() => {
              audioContext.resume();
              alert('Sound enabled! You can now hear the cat sound effects.');
            });
          }
        });

        // Drag handlers
        function dragStarted(event, d) {
          d3.select(this).raise().attr("stroke", "black");
          d.startX = d.x;
          d.startY = d.y;
        }

        function dragged(event, d) {
          d3.select(this)
            .attr("x", d.x = event.x)
            .attr("y", d.y = event.y);
        }

        function dragEnded(event, d) {
          playSound();

          // Calculate fling direction based on drag movement
          const deltaX = event.x - d.startX;
          const deltaY = event.y - d.startY;

          // Animate flinging motion
          d3.select(this)
            .transition()
            .duration(1000)
            .ease(d3.easeCubicOut)
            .attr("x", d.x + deltaX * 2)
            .attr("y", d.y + deltaY * 2)
            .attr("width", catSize / 2)
            .attr("height", catSize / 2)
            .on("end", () => {
              // Reset cat to original position after animation
              d3.select(this)
                .transition()
                .duration(500)
                .ease(d3.easeCubicInOut)
                .attr("x", d.x = catsData.find(cat => cat.id === d.id).x)
                .attr("y", d.y = height - 150)
                .attr("width", catSize)
                .attr("height", catSize);
            });
        }

        // Handle screen resizing
        window.addEventListener("resize", () => {
          width = window.innerWidth;
          height = window.innerHeight;
          d3.select("svg").attr("width", width).attr("height", height);
          
          // Update cat size and positions
          catSize = Math.min(100, width / 10);
          cats.attr("width", catSize).attr("height", catSize)
            .attr("x", (d, i) => d.x = i * (width / 4) + 100)
            .attr("y", d => d.y = height - 150);
        });
    </script>
</body>
</html>
